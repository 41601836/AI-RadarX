# 生产环境安全Checklist

## 1. 网络与基础设施安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **端口暴露** | 高 | 不必要的端口对外暴露 | - 只开放必要端口（3000、443等）<br>- 使用防火墙限制访问IP<br>- 避免直接暴露数据库端口 | □ |
| **HTTPS配置** | 高 | 未使用HTTPS或配置不当 | - 配置SSL/TLS证书<br>- 强制HTTPS重定向<br>- 启用HTTP/2<br>- 定期更新证书 | □ |
| **网络隔离** | 中 | 不同服务间未隔离 | - 使用VPC或子网隔离服务<br>- 配置网络访问控制列表<br>- Docker容器间使用私有网络 | □ |
| **DDoS防护** | 中 | 未配置DDoS防护 | - 使用云服务商DDoS防护<br>- 配置速率限制<br>- 启用CDN缓存 | □ |
| **SSH安全** | 高 | SSH配置不安全 | - 禁用root远程登录<br>- 使用密钥认证<br>- 更改默认端口<br>- 配置登录失败锁定 | □ |

## 2. 应用层安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **CORS配置** | 高 | 跨域资源共享配置不当 | - 只允许必要的域名访问<br>- 限制请求方法和头部<br>- 避免使用通配符`*` | □ |
| **CSRF防护** | 高 | 未启用跨站请求伪造防护 | - 使用Next.js内置CSRF保护<br>- 实现同步令牌模式<br>- 验证请求来源 | □ |
| **XSS防护** | 高 | 未防止跨站脚本攻击 | - 使用Next.js内置XSS保护<br>- 对用户输入进行转义<br>- 启用Content-Security-Policy | □ |
| **内容安全策略(CSP)** | 中 | 未配置或配置不当 | - 定义严格的CSP规则<br>- 限制脚本和样式来源<br>- 避免使用unsafe-inline | □ |
| **点击劫持防护** | 中 | 未防止点击劫持攻击 | - 配置X-Frame-Options头<br>- 启用Content-Security-Policy的frame-ancestors | □ |
| **错误信息泄漏** | 中 | 详细错误信息对外暴露 | - 生产环境禁用详细错误<br>- 自定义错误页面<br>- 不泄露堆栈信息 | □ |
| **API安全** | 高 | API接口未保护 | - 实现身份认证和授权<br>- 限制API请求速率<br>- 验证请求参数<br>- 使用HTTPS传输 | □ |

## 3. 数据安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **敏感数据加密** | 高 | 敏感数据未加密存储 | - 密码使用bcrypt等算法加密<br>- 敏感配置使用环境变量<br>- 传输数据使用HTTPS | □ |
| **数据备份** | 高 | 未定期备份数据 | - 制定备份策略（全量+增量）<br>- 备份数据加密存储<br>- 定期验证备份可用性<br>- 异地备份 | □ |
| **数据销毁** | 中 | 敏感数据销毁不彻底 | - 使用安全删除工具<br>- 数据库清除使用专门工具<br>- 物理存储设备销毁 | □ |
| **Redis安全** | 高 | Redis配置不安全 | - 设置强密码<br>- 禁用危险命令<br>- 不暴露公网<br>- 限制访问IP | □ |
| **数据访问审计** | 中 | 未审计数据访问 | - 记录敏感数据访问日志<br>- 定期审计访问记录<br>- 监控异常访问 | □ |

## 4. 容器与部署安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **容器镜像安全** | 高 | 使用不安全的基础镜像 | - 使用官方镜像<br>- 定期更新镜像<br>- 扫描镜像漏洞<br>- 使用最小化镜像 | □ |
| **容器隔离** | 中 | 容器间隔离不足 | - 使用Docker网络隔离<br>- 限制容器权限<br>- 避免容器间共享敏感数据 | □ |
| **非root用户运行** | 高 | 容器以root用户运行 | - 创建非root用户<br>- 在Dockerfile中使用USER指令<br>- 限制容器权限 | □ |
| **容器资源限制** | 中 | 未限制容器资源使用 | - 设置CPU和内存限制<br>- 配置存储限制<br>- 防止资源耗尽攻击 | □ |
| **Docker配置安全** | 中 | Docker daemon配置不安全 | - 禁用远程API或配置TLS<br>- 启用内容信任<br>- 定期更新Docker版本 | □ |
| **容器日志安全** | 中 | 日志包含敏感信息 | - 过滤日志中的敏感数据<br>- 配置日志加密存储<br>- 定期清理日志 | □ |

## 5. 访问控制与身份认证

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **强密码策略** | 高 | 密码策略过于宽松 | - 要求复杂密码（长度、大小写、特殊字符）<br>- 定期强制密码更改<br>- 实现密码强度检查 | □ |
| **多因素认证** | 高 | 未启用多因素认证 | - 为管理员账户启用MFA<br>- 支持TOTP或硬件密钥<br>- 关键操作二次验证 | □ |
| **最小权限原则** | 高 | 用户权限过高 | - 实现RBAC（基于角色的访问控制）<br>- 为用户分配最小必要权限<br>- 定期审查权限 | □ |
| **会话管理** | 中 | 会话配置不安全 | - 设置合理的会话超时<br>- 使用安全的会话存储<br>- 定期刷新会话令牌<br>- 实现会话失效机制 | □ |
| **JWT安全** | 高 | JWT配置不当 | - 使用强密钥签名<br>- 设置合理的过期时间<br>- 避免在JWT中存储敏感数据<br>- 实现令牌刷新机制 | □ |

## 6. 监控与审计

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **安全日志监控** | 高 | 未监控安全相关日志 | - 收集并分析安全日志<br>- 设置异常登录告警<br>- 监控敏感操作日志 | □ |
| **入侵检测** | 中 | 未部署入侵检测系统 | - 使用IDS/IPS系统<br>- 监控异常网络流量<br>- 检测恶意请求模式 | □ |
| **定期安全审计** | 中 | 未进行定期安全审计 | - 每月进行安全扫描<br>- 每季度进行全面审计<br>- 每年进行渗透测试 | □ |
| **漏洞扫描** | 高 | 未定期扫描漏洞 | - 使用漏洞扫描工具<br>- 扫描应用和依赖<br>- 扫描服务器和容器<br>- 及时修复发现的漏洞 | □ |

## 7. 依赖安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **依赖漏洞** | 高 | 依赖包存在已知漏洞 | - 定期更新依赖包<br>- 使用npm audit或pnpm audit<br>- 配置自动依赖更新<br>- 限制依赖版本范围 | □ |
| **依赖审查** | 中 | 未审查新增依赖 | - 审查依赖的安全性<br>- 检查依赖的许可证<br>- 避免使用不必要的依赖<br>- 优先使用知名依赖 | □ |
| **供应链攻击防护** | 高 | 未防止供应链攻击 | - 使用依赖锁定文件<br>- 验证依赖的完整性<br>- 使用私有依赖源<br>- 监控依赖的异常变更 | □ |

## 8. 应急响应

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **应急响应计划** | 高 | 未制定应急响应计划 | - 制定详细的应急响应流程<br>- 明确责任人和联系方式<br>- 定期演练应急响应 | □ |
| **灾难恢复计划** | 高 | 未制定灾难恢复计划 | - 制定数据恢复流程<br>- 测试灾难恢复方案<br>- 确保恢复时间目标(RTO) | □ |
| **安全事件报告** | 中 | 未建立安全事件报告机制 | - 建立事件报告渠道<br>- 定义报告流程和时限<br>- 定期通报安全事件 | □ |

## 9. Next.js应用特定安全

| 检查项目 | 风险级别 | 描述 | 修复建议 | 状态 |
|----------|----------|------|----------|------|
| **Next.js版本更新** | 高 | 使用过时的Next.js版本 | - 定期更新Next.js版本<br>- 关注安全补丁<br>- 测试兼容性 | □ |
| **环境变量安全** | 高 | 敏感信息硬编码 | - 使用环境变量存储敏感信息<br>- 避免在客户端代码中暴露密钥<br>- 使用.env.local文件并添加到.gitignore | □ |
| **静态资源安全** | 中 | 静态资源未保护 | - 配置适当的缓存策略<br>- 启用资源完整性检查<br>- 限制敏感资源访问 | □ |
| **服务端渲染安全** | 中 | SSR代码存在安全问题 | - 验证所有用户输入<br>- 使用参数化查询<br>- 避免在SSG中包含敏感信息 | □ |
| **API路由安全** | 高 | API路由未保护 | - 实现认证和授权<br>- 验证请求参数<br>- 限制请求频率<br>- 处理错误和异常 | □ |

## 10. 安全最佳实践

### 10.1 开发阶段
- 实施安全左移，在开发阶段引入安全检查
- 进行安全代码审查
- 编写安全测试用例
- 培训开发人员安全意识

### 10.2 部署阶段
- 自动化安全扫描集成到CI/CD流程
- 实施基础设施即代码(IaC)安全检查
- 部署前进行安全验证

### 10.3 运维阶段
- 定期更新系统和应用
- 监控安全态势
- 进行安全意识培训
- 定期进行安全评估

## 11. 检查结果汇总

| 风险级别 | 已完成 | 待完成 | 百分比 |
|----------|--------|--------|--------|
| 高 | 0 | 0 | 0% |
| 中 | 0 | 0 | 0% |
| 低 | 0 | 0 | 0% |
| **总计** | 0 | 0 | 0% |

## 12. 附录：安全工具推荐

### 12.1 漏洞扫描工具
- **OWASP ZAP**：开源Web应用安全扫描器
- **Nessus**：全面的漏洞评估工具
- **Snyk**：依赖漏洞扫描和管理
- **Trivy**：容器和代码漏洞扫描

### 12.2 安全测试工具
- **Burp Suite**：Web应用安全测试
- **Metasploit**：渗透测试框架
- **Wireshark**：网络协议分析
- **Sqlmap**：SQL注入测试

### 12.3 监控和日志工具
- **ELK Stack**：日志收集、分析和可视化
- **Prometheus + Grafana**：监控和告警
- **Falco**：容器运行时安全监控
- **OSSEC**：主机入侵检测

## 13. 参考文档

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Next.js安全指南](https://nextjs.org/docs/advanced-features/security)
- [Docker安全最佳实践](https://docs.docker.com/engine/security/)
- [NIST网络安全框架](https://www.nist.gov/cyberframework)

---

**更新日期**：2024-01-01
**负责人**：_________
**审核人**：_________