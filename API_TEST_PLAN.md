# AI交易终端API测试计划

## 1. 测试概述

本测试计划旨在对AI交易终端的API接口进行全面测试，确保其功能正确性、性能稳定性、安全性和符合API规范。测试将覆盖所有核心模块，包括筹码分析、舆情分析、游资行为分析、大单异动分析、风险控制分析、技术分析和市场数据模块。

## 2. 测试范围

### 2.1 测试模块

- **筹码分析模块** (`/api/v1/chip/*`)
- **舆情分析模块** (`/api/v1/public/opinion/*`)
- **游资行为分析模块** (`/api/v1/heat/flow/*`)
- **大单异动分析模块** (`/api/v1/order/large/*`)
- **风险控制分析模块** (`/api/v1/risk/*`)
- **技术分析模块** (`/api/v1/tech/*`)
- **市场数据模块** (`/api/v1/market/*`)

### 2.2 测试类型

- **契约测试**：验证API响应是否符合OpenAPI规范
- **功能测试**：验证API功能的正确性和完整性
- **性能测试**：测量API的响应时间和资源使用情况
- **负载测试**：测试API在高并发情况下的性能表现
- **安全测试**：检查API的安全性，包括认证、授权、输入验证等

## 3. 测试策略

### 3.1 契约测试

- **工具**：使用OpenAPI Validator或类似工具
- **测试方法**：
  - 验证API请求参数格式是否符合规范
  - 验证API响应结构是否符合规范
  - 验证API响应状态码是否符合规范
  - 验证API响应头是否符合规范

### 3.2 功能测试

- **工具**：Jest、Supertest或类似工具
- **测试方法**：
  - **正面测试**：使用有效输入验证API功能的正确性
  - **负面测试**：使用无效输入、缺失参数等验证API的错误处理能力
  - **边界测试**：测试参数的边界值
  - **集成测试**：测试API之间的集成关系

### 3.3 性能测试

- **工具**：Artillery、k6或类似工具
- **测试方法**：
  - 测量各API端点的响应时间（50th、90th、95th、99th百分位）
  - 监控CPU、内存等资源使用情况
  - 测试数据库查询性能
  - 验证缓存机制的有效性

### 3.4 负载测试

- **工具**：Artillery、k6或类似工具
- **测试方法**：
  - 模拟不同并发用户数（10、50、100、500、1000）
  - 测试API的最大负载能力
  - 测试API在长时间高负载下的稳定性
  - 测试API的恢复能力

### 3.5 安全测试

- **工具**：OWASP ZAP、Postman或类似工具
- **测试方法**：
  - 验证认证和授权机制
  - 测试SQL注入、XSS等常见攻击
  - 检查敏感数据泄露
  - 验证输入验证和输出编码

## 4. 测试用例

### 4.1 筹码分析模块

#### 4.1.1 获取单只股票筹码分布数据 (`/api/v1/chip/distribution`)

**正面测试用例：**
- [ ] 使用有效股票代码（如SH600000）获取筹码分布数据
- [ ] 使用有效股票代码和日期范围获取筹码分布数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码（如ABC123）
- [ ] 提供不存在的股票代码
- [ ] 提供无效的日期格式
- [ ] 提供结束日期早于开始日期的日期范围

#### 4.1.2 获取股票筹码趋势变化 (`/api/v1/chip/trend`)

**正面测试用例：**
- [ ] 使用有效股票代码获取筹码趋势数据
- [ ] 使用有效股票代码和天数参数获取筹码趋势数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的天数参数（如负数、0）
- [ ] 提供超过最大限制的天数参数（如366天）

### 4.2 舆情分析模块

#### 4.2.1 获取单只股票舆情汇总 (`/api/v1/public/opinion/summary`)

**正面测试用例：**
- [ ] 使用有效股票代码获取舆情汇总数据
- [ ] 使用有效股票代码和时间范围获取舆情汇总数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的时间范围参数（如"10d"）

#### 4.2.2 获取股票舆情详情列表 (`/api/v1/public/opinion/list`)

**正面测试用例：**
- [ ] 使用有效股票代码获取舆情详情列表
- [ ] 使用有效股票代码和时间范围获取舆情详情列表
- [ ] 使用有效股票代码和情绪类型获取舆情详情列表
- [ ] 使用有效股票代码和分页参数获取舆情详情列表

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的时间范围参数
- [ ] 提供无效的情绪类型参数
- [ ] 提供无效的分页参数（如负数页码）
- [ ] 提供超过最大限制的每页条数（如101）

### 4.3 游资行为分析模块

#### 4.3.1 获取单只股票游资席位数据 (`/api/v1/heat/flow/stock/seat`)

**正面测试用例：**
- [ ] 使用有效股票代码获取游资席位数据
- [ ] 使用有效股票代码和日期范围获取游资席位数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的日期格式
- [ ] 提供结束日期早于开始日期的日期范围

#### 4.3.2 获取游资行为预警列表 (`/api/v1/heat/flow/alert/list`)

**正面测试用例：**
- [ ] 获取游资行为预警列表
- [ ] 使用预警等级参数获取游资行为预警列表
- [ ] 使用分页参数获取游资行为预警列表

**负面测试用例：**
- [ ] 提供无效的预警等级参数
- [ ] 提供无效的分页参数

#### 4.3.3 席位风险扫描 (`/api/v1/heat/flow/seat/risk-scan`)

**正面测试用例：**
- [ ] 扫描全部龙虎榜股票的席位风险
- [ ] 扫描指定股票的席位风险
- [ ] 扫描指定日期的席位风险

**负面测试用例：**
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的日期格式

### 4.4 大单异动分析模块

#### 4.4.1 获取单只股票实时大单数据 (`/api/v1/order/large/real-time`)

**正面测试用例：**
- [ ] 使用有效股票代码获取实时大单数据
- [ ] 使用有效股票代码和大单阈值获取实时大单数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的大单阈值参数（如负数）

#### 4.4.2 获取股票大单趋势数据 (`/api/v1/order/large/trend`)

**正面测试用例：**
- [ ] 使用有效股票代码获取大单趋势数据
- [ ] 使用有效股票代码和时间类型获取大单趋势数据
- [ ] 使用有效股票代码和天数参数获取大单趋势数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的时间类型参数
- [ ] 提供无效的天数参数（如负数、0）

### 4.5 风险控制分析模块

#### 4.5.1 获取账户风险评估报告 (`/api/v1/risk/account/assessment`)

**正面测试用例：**
- [ ] 获取账户风险评估报告

**负面测试用例：**
- [ ] 未授权访问

#### 4.5.2 自定义止损/止盈规则配置 (`/api/v1/risk/stop/rule/config`)

**正面测试用例：**
- [ ] 创建止损规则配置
- [ ] 创建止盈规则配置
- [ ] 更新现有规则配置

**负面测试用例：**
- [ ] 不提供必要参数（如stockCode、stopType等）
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的stopType参数
- [ ] 提供无效的ruleType参数
- [ ] 提供无效的value参数（如负数）
- [ ] 提供无效的isEnabled参数（如字符串）

### 4.6 技术分析模块

#### 4.6.1 获取单只股票技术指标数据 (`/api/v1/tech/indicator/data`)

**正面测试用例：**
- [ ] 使用有效股票代码获取技术指标数据
- [ ] 使用有效股票代码和周期类型获取技术指标数据
- [ ] 使用有效股票代码和指标类型获取技术指标数据
- [ ] 使用有效股票代码和天数参数获取技术指标数据

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的周期类型参数
- [ ] 提供无效的指标类型参数
- [ ] 提供无效的天数参数（如负数、0）

#### 4.6.2 识别股票K线形态 (`/api/v1/tech/kline/pattern/recognize`)

**正面测试用例：**
- [ ] 使用有效股票代码识别K线形态
- [ ] 使用有效股票代码和周期类型识别K线形态
- [ ] 使用有效股票代码和天数参数识别K线形态

**负面测试用例：**
- [ ] 不提供股票代码
- [ ] 提供无效格式的股票代码
- [ ] 提供不存在的股票代码
- [ ] 提供无效的周期类型参数
- [ ] 提供无效的天数参数（如负数、0）

### 4.7 市场数据模块

#### 4.7.1 获取股票基本信息 (`/api/v1/market/stock/basic`)

**正面测试用例：**
- [ ] 获取股票基本信息列表

**负面测试用例：**
- [ ] 未授权访问

## 5. 测试环境和工具

### 5.1 测试环境

- **开发环境**：http://localhost:3000
- **测试环境**：待定
- **生产环境**：待定

### 5.2 测试工具

| 测试类型 | 工具 |
|---------|------|
| 契约测试 | OpenAPI Validator |
| 功能测试 | Jest、Supertest |
| 性能测试 | Artillery、k6 |
| 负载测试 | Artillery、k6 |
| 安全测试 | OWASP ZAP、Postman |

## 6. 测试执行计划

### 6.1 测试阶段

1. **契约测试阶段**：验证所有API端点是否符合OpenAPI规范
2. **功能测试阶段**：执行所有功能测试用例
3. **性能测试阶段**：测量各API端点的性能指标
4. **负载测试阶段**：测试API在高并发情况下的表现
5. **安全测试阶段**：检查API的安全性

### 6.2 测试时间表

| 测试阶段 | 预计时间 |
|---------|---------|
| 契约测试 | 1天 |
| 功能测试 | 3天 |
| 性能测试 | 1天 |
| 负载测试 | 1天 |
| 安全测试 | 1天 |
| 测试报告 | 1天 |
| **总计** | **8天** |

## 7. 测试结果分析和报告

### 7.1 测试结果分析

- **通过/失败统计**：统计每个测试用例的通过/失败情况
- **缺陷分类**：将缺陷按照严重程度、类型进行分类
- **性能分析**：分析API的性能指标，识别性能瓶颈
- **安全分析**：分析API的安全漏洞，提出修复建议

### 7.2 测试报告

测试报告应包含以下内容：
- **测试概述**：测试目的、范围、方法
- **测试环境**：测试环境配置
- **测试结果**：通过/失败统计、缺陷列表
- **性能测试结果**：响应时间、资源使用情况等
- **负载测试结果**：并发用户数、吞吐量等
- **安全测试结果**：安全漏洞、修复建议
- **结论和建议**：测试结论、改进建议